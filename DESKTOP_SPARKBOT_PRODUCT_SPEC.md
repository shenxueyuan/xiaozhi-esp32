# Desktop SparkBot 桌面机器人 - 产品功能规格书

## 📋 产品概述

**Desktop SparkBot** 是基于ESP32-S3芯片的智能桌面机器人，具备丰富的表情显示、灵活的机械动作和智能的情绪交互能力。产品继承了ESP-SparkBot的所有基础功能，并在此基础上扩展了全屏表情显示和双电机动作控制系统。

---

## 🎯 核心功能特性

### 1. 智能表情显示系统

#### **1.1 全屏GIF表情显示**
- **显示规格**: 240×240像素全屏显示
- **表情类型**: 6种基础GIF动画表情
- **表情资源**: 复用Otto Robot成熟的表情库
- **显示效果**: 流畅的GIF动画播放，支持可变帧率

#### **1.2 表情类型与映射**

| 表情分类 | 支持的表情名称 | 对应GIF资源 | 播放帧率 |
|---------|---------------|------------|---------|
| **中性平静类** | `neutral`, `relaxed`, `sleepy` | `staticstate` | 8-15 FPS |
| **积极开心类** | `happy`, `laughing`, `funny`, `loving`, `confident`, `winking`, `cool`, `delicious`, `kissy`, `silly` | `happy` | 15-30 FPS |
| **悲伤类** | `sad`, `crying` | `sad` | 15-20 FPS |
| **愤怒类** | `angry` | `anger` | 30 FPS |
| **惊讶类** | `surprised`, `shocked` | `scare` | 25-30 FPS |
| **思考困惑类** | `thinking`, `confused`, `embarrassed` | `buxue` | 10-15 FPS |

#### **1.3 表情控制特性**
- **动态帧率调节**: 根据情绪强度自动调整播放速度
- **智能映射**: 21种表情名称智能映射到6个GIF资源
- **主题支持**: 深色主题适配，适合桌面环境
- **实时切换**: 毫秒级表情切换响应

---

### 2. 双轴机械动作系统

#### **2.1 硬件规格**
- **电机类型**: 减速电机 × 2
- **控制方式**: PWM调速 + GPIO方向控制
- **PWM频率**: 1000Hz
- **PWM分辨率**: 10位 (1024级调速)

#### **2.2 动作轴配置**

| 动作轴 | 控制范围 | GPIO配置 | 功能描述 |
|-------|---------|----------|---------|
| **头部轴** | -45° ~ +45° | PWM: GPIO1<br/>DIR1: GPIO2<br/>DIR2: GPIO3 | 头部上下点头动作 |
| **身体轴** | -90° ~ +90° | PWM: GPIO14<br/>DIR1: GPIO19<br/>DIR2: GPIO20 | 身体左右摆动 |

#### **2.3 动作控制模式**

##### **基础动作**
- `HeadUp(speed)` - 头部向上
- `HeadDown(speed)` - 头部向下  
- `HeadCenter(speed)` - 头部回中
- `BodyLeft(speed)` - 身体向左
- `BodyRight(speed)` - 身体向右
- `BodyCenter(speed)` - 身体回中

##### **速度档位**
- **慢速模式**: 200 (平滑动作)
- **标准模式**: 400 (日常动作)
- **快速模式**: 600 (激烈反应)
- **最高速度**: 800 (紧急动作)

#### **2.4 情绪动作映射**

| 情绪类型 | 头部动作 | 身体动作 | 动作特点 |
|---------|---------|---------|---------|
| **中性** | 回中心位置 | 回中心位置 | 平稳回正 |
| **开心** | 快速点头 | 左右摆动 | 活泼欢快 |
| **悲伤** | 缓慢下垂 | 轻微下沉 | 低沉缓慢 |
| **愤怒** | 快速摆动 | 激烈左右摆 | 剧烈震动 |
| **惊讶** | 快速抬头 | 身体后仰 | 突然反应 |
| **思考** | 轻微左右摆 | 保持静止 | 思考状态 |

---

### 3. 情绪交互系统

#### **3.1 情绪识别与响应**
- **输入方式**: 通过`SetEmotion(emotion_name)`接口
- **响应时间**: < 100ms
- **联动效果**: 表情显示 + 机械动作同步执行
- **强度控制**: 支持1-3级强度调节

#### **3.2 智能动作编排**
- **动作序列**: 支持多步骤动作组合
- **时间控制**: 精确的动作时序控制
- **平滑过渡**: 动作间的平滑过渡效果
- **异步执行**: 非阻塞式动作执行

#### **3.3 个性化设置**
- **强度缩放**: 动作强度可调节 (0.5x - 1.5x)
- **启用开关**: 可独立关闭动作功能
- **速度调节**: 动作速度实时可调

---

### 4. 远程控制系统 (MCP)

#### **4.1 MCP工具注册**
- **工具名称**: `desktop_sparkbot_control`
- **控制方式**: JSON-RPC协议
- **连接方式**: WiFi网络远程控制

#### **4.2 远程控制功能**

##### **表情控制**
```json
{
  "emotion": "happy",
  "intensity": 2
}
```

##### **电机控制**
```json
{
  "head_angle": 30,
  "body_angle": -45,
  "speed": 400
}
```

##### **系统设置**
```json
{
  "enable_motion": true,
  "intensity_scale": 1.2
}
```

#### **4.3 状态监控**
- **实时状态**: 当前表情、电机位置、系统状态
- **错误报告**: 硬件故障、连接状态监控
- **性能指标**: CPU使用率、内存占用、温度监控

---

### 5. 基础硬件功能 (继承ESP-SparkBot)

#### **5.1 音频系统**
- **音频编解码**: ES8311专业音频芯片
- **麦克风**: 高灵敏度数字麦克风
- **扬声器**: 内置扬声器输出
- **音频处理**: ESP-AFE音频前端处理

#### **5.2 视觉系统**
- **摄像头**: OV3660高清摄像头
- **分辨率**: 最高支持2048×1536
- **视频流**: 实时视频流传输
- **图像处理**: 基础图像处理功能

#### **5.3 连接功能**
- **WiFi**: 2.4GHz WiFi连接
- **网络协议**: HTTP、MQTT、WebSocket
- **OTA升级**: 无线固件更新
- **配网**: 智能配网功能

#### **5.4 存储系统**
- **Flash**: 16MB外部Flash存储
- **PSRAM**: 8MB外部PSRAM
- **文件系统**: SPIFFS文件系统
- **配置存储**: NVS非易失性存储

---

## 🔧 技术规格

### 硬件规格
- **主控芯片**: ESP32-S3 (双核240MHz)
- **内存**: 512KB SRAM + 8MB PSRAM
- **存储**: 16MB Flash
- **显示**: 240×240 ST7789 LCD
- **电机**: 2×减速电机 (PWM控制)
- **音频**: ES8311编解码器
- **摄像头**: OV3660
- **连接**: WiFi 2.4GHz
- **电源**: 5V USB供电

### 软件架构
- **操作系统**: FreeRTOS
- **开发框架**: ESP-IDF v5.4.1
- **图形库**: LVGL v8.3
- **音频**: ESP-AFE + Opus编码
- **网络**: ESP-WiFi + lwIP
- **协议**: MCP (JSON-RPC)

---

## 📦 功能模块清单

### 已实现功能 ✅
- [x] **全屏GIF表情显示系统**
- [x] **双轴减速电机控制系统**  
- [x] **情绪联动动作系统**
- [x] **MCP远程控制接口**
- [x] **21种表情名称支持**
- [x] **6种基础GIF动画**
- [x] **PWM精确调速控制**
- [x] **异步动作执行系统**
- [x] **配置系统集成**
- [x] **错误处理与恢复**
- [x] **基础硬件功能继承**

### 扩展功能建议 💡
- [ ] **语音控制表情切换**
- [ ] **手势识别动作触发**
- [ ] **定时任务与场景模式**
- [ ] **多机器人协同控制**
- [ ] **AI情绪分析集成**
- [ ] **自定义动作编程**

---

## 🚀 使用场景

### 办公桌面助手
- **会议提醒**: 通过表情和动作提示会议时间
- **心情表达**: 根据工作状态显示对应表情
- **互动娱乐**: 工作间隙的放松互动

### 智能家居终端
- **状态指示**: 通过表情显示家居设备状态
- **语音交互**: 配合语音助手的视觉反馈
- **氛围营造**: 根据环境调节表情和动作

### 教育演示工具
- **情绪教学**: 直观展示各种情绪表达
- **编程教育**: 作为可编程机器人教学工具
- **互动展示**: 展会、演示中的吸睛利器

---

## 📞 技术支持

### 开发资源
- **源代码**: GitHub开源项目
- **文档**: 完整的开发文档和API参考
- **示例**: 丰富的使用示例和教程
- **社区**: 开发者社区支持

### 定制服务
- **硬件定制**: 根据需求定制硬件配置
- **功能开发**: 定制化功能开发服务
- **技术咨询**: 专业技术支持和咨询
- **批量生产**: 小批量生产支持

---

**Desktop SparkBot** - 让您的桌面充满生机与智慧！ 🤖✨
