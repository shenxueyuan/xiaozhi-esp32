# 🤖 Desktop SparkBot 完整功能清单

## 📋 产品概述

**Desktop SparkBot** 是基于 ESP32-S3 的智能桌面机器人，完全继承 ESP-SparkBot 所有功能，并新增全屏表情显示和步进电机动作控制。

---

## 🎯 **一、基础系统功能**

### **1.1 硬件系统**
| 组件 | 规格 | 功能描述 |
|------|------|---------|
| **主控芯片** | ESP32-S3 双核240MHz | 高性能主控，支持WiFi |
| **内存** | 512KB SRAM + 8MB PSRAM | 大容量内存支持复杂应用 |
| **存储** | 16MB Flash | 存储固件、配置、资源文件 |
| **电源** | 5V USB供电 | 支持USB-C供电 |

### **1.2 网络连接**
| 功能 | 实现方式 | 说明 |
|------|---------|------|
| **WiFi连接** | ESP32-S3 内置WiFi | 2.4GHz WiFi支持 |
| **智能配网** | WifiConfigurationAp | 热点配网模式 |
| **网络协议** | HTTP/MQTT/WebSocket | 多协议支持 |
| **OTA升级** | 无线固件更新 | 远程固件升级 |
| **音频配网** | AFSK音频配网 | 通过音频传输WiFi凭据 |

---

## 🎭 **二、表情显示系统**

### **2.1 显示硬件**
- **屏幕**: 240×240 ST7789 LCD
- **接口**: SPI高速传输
- **背光**: PWM调光控制
- **色彩**: 全彩显示支持

### **2.2 全屏表情显示**
| 表情类别 | 表情名称 | GIF资源 | 帧率 |
|---------|---------|---------|------|
| **中性平静** | `neutral`, `relaxed`, `sleepy` | `staticstate` | 8-15 FPS |
| **积极开心** | `happy`, `laughing`, `funny`, `loving`, `confident`, `winking`, `cool`, `delicious`, `kissy`, `silly` | `happy` | 15-30 FPS |
| **悲伤类** | `sad`, `crying` | `sad` | 15-20 FPS |
| **愤怒类** | `angry` | `anger` | 30 FPS |
| **惊讶类** | `surprised`, `shocked` | `scare` | 25-30 FPS |
| **思考困惑** | `thinking`, `confused`, `embarrassed` | `buxue` | 10-15 FPS |

### **2.3 显示功能**
- ✅ **状态显示**: 待机、连接、听取、播放状态
- ✅ **聊天消息**: 实时对话内容显示
- ✅ **通知提示**: 系统通知和提醒
- ✅ **网络状态**: WiFi信号强度图标
- ✅ **设备信息**: 设备状态和基本信息

---

## 🎵 **三、音频系统**

### **3.1 音频硬件**
| 组件 | 型号/规格 | GPIO配置 |
|------|----------|----------|
| **音频编解码器** | ES8311 | I2C: GPIO4(SDA), GPIO5(SCL) |
| **I2S音频接口** | ESP32-S3内置 | MCLK:45, BCLK:39, WS:41, DIN:40, DOUT:42 |
| **功放控制** | 内置PA | PA_PIN: GPIO46 |
| **采样率** | 16kHz输入/输出 | 支持实时音频处理 |

### **3.2 语音功能**
| 功能模块 | 实现技术 | 功能说明 |
|---------|---------|---------|
| **语音唤醒** | AFE/ESP/Custom WakeWord | 支持多种唤醒词引擎 |
| **语音识别** | 云端ASR | 实时语音转文字 |
| **语音合成** | 云端TTS | 文字转语音播放 |
| **回声消除** | AEC算法 | 消除回声和噪音 |
| **VAD检测** | 语音活动检测 | 自动检测说话状态 |

### **3.3 音频处理**
- ✅ **音频编码**: Opus编码压缩
- ✅ **音频重采样**: 多采样率支持
- ✅ **音频增强**: AFE音频前端处理
- ✅ **音量控制**: 可调节音量大小
- ✅ **声音播放**: 支持提示音、音效

---

## 📸 **四、视觉系统**

### **4.1 摄像头硬件**
| 参数 | 规格 | GPIO配置 |
|------|------|----------|
| **摄像头** | OV3660 | XCLK:15, PCLK:13, VSYNC:6, HSYNC:7 |
| **数据线** | 8位并行 | D0-D7: GPIO11,9,8,10,12,18,17,16 |
| **最大分辨率** | 2048×1536 | 支持多种分辨率 |
| **帧率** | 可配置 | 根据分辨率自动调整 |

### **4.2 视觉功能**
- ✅ **实时图像**: 实时图像采集和传输
- ✅ **视频流**: 网络视频流传输
- ✅ **图像翻转**: 支持水平/垂直翻转
- ✅ **分辨率调节**: 多种分辨率选择
- ✅ **图像处理**: 基础图像处理功能

---

## 🤖 **五、机械动作系统** ⭐

### **5.1 步进电机配置**
| 轴向 | 电机引脚 | 控制方式 | 角度范围 |
|------|----------|----------|----------|
| **头部上下** | GPIO1, GPIO2 | 2引脚步进控制 | -45° ~ +45° |
| **身体左右** | GPIO14, GPIO3 | 2引脚步进控制 | -90° ~ +90° |

### **5.2 速度等级**
| 速度等级 | 脉冲间隔 | 适用场景 |
|---------|----------|----------|
| **慢速** | 50ms | 平静、思考、待机动作 |
| **中速** | 25ms | 开心、悲伤表达 |
| **快速** | 10ms | 愤怒、惊讶反应 |

### **5.3 动作控制**
```cpp
// 基础动作
HeadUp(steps, speed)           // 头部向上
HeadDown(steps, speed)         // 头部向下
HeadCenter(speed)              // 头部回中
HeadNod(times, speed)          // 点头动作

BodyTurnLeft(steps, speed)     // 身体向左
BodyTurnRight(steps, speed)    // 身体向右
BodyCenter(speed)              // 身体回中
BodyShake(times, speed)        // 摇摆动作
```

### **5.4 情绪动作映射**
| 情绪 | 动作组合 | 延迟时间 | 特点 |
|------|---------|----------|------|
| **happy** | 快速点头 + 身体摇摆 + 轻微上扬 | 500ms | 活泼欢快 |
| **sad** | 缓慢下垂 + 身体左倾 | 800ms | 低沉沉闷 |
| **angry** | 激烈摇头 + 快速身体摇摆 | 200ms | 剧烈震动 |
| **surprised** | 突然停止 + 快速上扬 + 身体后缩 | 100ms | 突然反应 |
| **thinking** | 左右摇身 + 轻微点头 | 1000ms | 思考状态 |
| **neutral** | 平稳回到中心位置 | 1500ms | 回归中心 |

### **5.5 智能待机动作**
- 📍 **待机频率**: 每5秒自动执行
- 🔄 **动作类型**:
  - 微微点头观察
  - 轻微左右扫视
  - 头部上下观察
- 🎯 **目的**: 模拟机器人在观察环境，增强真实感

---

## 📱 **六、远程控制系统 (MCP)**

### **6.1 MCP工具架构**
- **协议**: JSON-RPC over WebSocket
- **工具注册**: 动态工具注册机制
- **参数验证**: 类型检查和范围验证
- **错误处理**: 完善的错误处理机制

### **6.2 表情控制工具**
```json
{
  "name": "self.desktop.set_emotion_with_action",
  "params": {
    "emotion": "happy",
    "intensity": 2,
    "enable_motion": true
  }
}
```

### **6.3 电机控制工具**
```json
// 头部控制
{
  "name": "self.head.up_down",
  "params": {
    "angle": 30,
    "speed": 2
  }
}

// 身体控制
{
  "name": "self.body.left_right",
  "params": {
    "angle": -45,
    "speed": 1
  }
}
```

### **6.4 底盘控制工具**
```json
// 移动控制
{
  "name": "self.chassis.go_forward"    // 前进
  "name": "self.chassis.go_back"       // 后退
  "name": "self.chassis.turn_left"     // 向左转
  "name": "self.chassis.turn_right"    // 向右转
  "name": "self.chassis.dance"         // 跳舞模式
}

// 灯光控制
{
  "name": "self.chassis.switch_light_mode",
  "params": {
    "light_mode": 3
  }
}
```

### **6.5 系统配置工具**
```json
// 动作配置
{
  "name": "self.desktop.motion_config",
  "params": {
    "enabled": true,
    "intensity_scale": 1.2
  }
}

// 摄像头配置
{
  "name": "self.camera.set_camera_flipped"
}
```

---

## 🎮 **七、用户交互功能**

### **7.1 按键控制**
- **BOOT按键** (GPIO0): 设备重启、配置模式
- **音量控制**: 软件音量调节
- **功能切换**: 模式切换控制

### **7.2 状态反馈**
- **LED指示**: 设备状态LED显示
- **屏幕状态**: 实时状态信息显示
- **语音提示**: 操作确认和状态播报
- **动作反馈**: 情绪和状态的动作表达

### **7.3 配置管理**
- **WiFi配置**: 热点配网和音频配网
- **设备设置**: NVS存储的持久化配置
- **OTA升级**: 远程固件更新
- **恢复出厂**: 配置重置功能

---

## 🔧 **八、系统功能**

### **8.1 文件系统**
- **SPIFFS**: 资源文件存储
- **NVS**: 配置数据存储
- **分区表**: 固件和数据分区管理

### **8.2 任务管理**
| 任务名称 | 优先级 | 栈大小 | 功能描述 |
|---------|-------|--------|---------|
| **audio_input** | 8 | 6KB | 音频输入处理 |
| **audio_output** | 3 | 4KB | 音频输出播放 |
| **motor_task** | 5 | 4KB | 电机控制任务 |
| **idle_action_task** | 3 | 2KB | 待机动作任务 |
| **wifi_task** | 6 | 4KB | WiFi连接管理 |

### **8.3 内存管理**
- **堆内存**: 动态内存分配管理
- **栈内存**: 任务栈大小优化
- **PSRAM**: 大内存数据缓存
- **内存监控**: 实时内存使用监控

### **8.4 电源管理**
- **功耗优化**: WiFi省电模式
- **温度监控**: ESP32温度监测
- **电源状态**: 供电状态检测

---

## 🌐 **九、网络服务**

### **9.1 协议支持**
- **HTTP**: RESTful API服务
- **WebSocket**: 实时双向通信
- **MQTT**: 物联网消息协议
- **UDP**: 低延迟数据传输

### **9.2 服务功能**
- **设备发现**: mDNS设备发现
- **状态上报**: 实时状态同步
- **远程控制**: MCP远程控制协议
- **固件升级**: OTA在线升级

---

## 🔐 **十、安全功能**

### **10.1 网络安全**
- **WPA2加密**: WiFi连接加密
- **TLS/SSL**: 安全传输层
- **设备认证**: MAC地址识别
- **访问控制**: 权限管理

### **10.2 数据安全**
- **配置加密**: 敏感配置加密存储
- **数据校验**: 数据完整性检查
- **安全启动**: 固件签名验证

---

## 📊 **十一、监控和诊断**

### **11.1 系统监控**
```json
// 设备状态JSON
{
  "cpu_usage": "15%",
  "memory_usage": "45%",
  "temperature": 45.2,
  "wifi_rssi": -45,
  "uptime": 3600,
  "current_emotion": "happy",
  "motor_status": "idle"
}
```

### **11.2 日志系统**
- **ESP_LOG**: 分级日志输出
- **串口监控**: 实时日志查看
- **远程日志**: 网络日志传输
- **错误追踪**: 错误堆栈跟踪

---

## 🚀 **十二、使用场景**

### **12.1 办公桌面助手**
- 💼 **会议提醒**: 情绪和动作提示
- 😊 **心情表达**: 根据工作状态显示
- 🎯 **互动娱乐**: 工作间隙放松

### **12.2 智能家居终端**
- 🏠 **状态指示**: 家居设备状态显示
- 🗣️ **语音交互**: 语音助手视觉反馈
- 🌅 **氛围营造**: 环境氛围调节

### **12.3 教育演示工具**
- 📚 **情绪教学**: 情绪表达教学
- 💻 **编程教育**: 可编程机器人教学
- 🎪 **互动展示**: 展会演示利器

---

## 📋 **十三、完整API清单**

### **13.1 表情控制API**
```cpp
// C++ API
SetEmotion("happy")                    // 设置表情
SetEmotionIntensity(2)                 // 设置强度

// MCP API
self.desktop.set_emotion_with_action   // 表情+动作联动
self.emotion.express                   // 情绪表达
```

### **13.2 电机控制API**
```cpp
// C++ API
motor_controller->HeadUp(2, MOTOR_SPEED_FAST)
motor_controller->BodyShake(3, MOTOR_SPEED_NORMAL)
motor_controller->PerformEmotionAction("angry", 3)

// MCP API
self.head.up_down                      // 头部控制
self.body.left_right                   // 身体控制
self.action.idle                       // 待机动作
```

### **13.3 系统控制API**
```cpp
// 音频控制
GetAudioCodec()->SetVolume(80)
audio_service.EnableWakeWordDetection(true)

// 显示控制
GetDisplay()->SetBrightness(200)
GetBacklight()->SetBrightness(80)

// 网络控制
ResetWifiConfiguration()
SetPowerSaveMode(true)
```

---

## ✅ **总结**

**Desktop SparkBot** 是一个功能完整的智能桌面机器人，具备：

🎭 **21种表情** → 6个GIF动画 → 全屏240×240显示
🤖 **6种情绪动作** → 双轴步进电机 → 3级速度控制
🗣️ **语音交互** → 唤醒+识别+合成 → ES8311音频系统
📸 **视觉感知** → OV3660摄像头 → 实时图像传输
🌐 **远程控制** → MCP协议 → 50+控制工具
⚙️ **系统完整** → WiFi+OTA+配置 → 企业级稳定性

**技术栈**: ESP32-S3 + FreeRTOS + LVGL + ESP-IDF + WiFi + 步进电机
**适用场景**: 办公助手 + 智能家居 + 教育展示 + 娱乐互动

🚀 **一次调用，表情+动作完美联动，打造最具表现力的桌面机器人！**

